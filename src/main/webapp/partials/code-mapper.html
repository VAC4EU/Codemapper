
<div>
  
  <alert ng-if="message != null" type="success" close="unsetMessage()">{{message}}</alert>
  
  <tabset>

    <tab id="case-definition-tab" heading="1. Case definition">
      <label>Free text case definition</label>
      <div block-ui="inputBlockUi">
        <textarea rows=35 cols=200 ng-model="$parent.$parent.caseDefinition" class="case-definition"></textarea>
      </div>
    </tab>
    
    <tab id="semantics-tab" heading="2. Semantic types" ng-controller="SemanticTypesCtrl">
      <div block-ui="inputBlockUi">
      <div class="row">
        <div class="col-md-2">
          <div>
            <label for='samanticTypesFilter'>Filter {{all.count}} semantic types</label>
            <i class="glyphicon glyphicon-filter"></i>
            <input id='samanticTypesFilter' type="text" ng-model="gridOptions.filterOptions.filterText" />
          </div>
          <div class='btn-group'> 
            <button class='btn btn-default btn-sm' ng-click="gridOptions.selectAll(true)">
              <i class="glyphicon glyphicon-expand"></i>
              Select all
            </button>
            <button class='btn btn-default btn-sm' ng-click="gridOptions.selectAll(false)">
              <i class="glyphicon glyphicon-unchecked"></i>
              none
            </button>
          </div>
        </div>
        <div class="col-md-10">
          <label for='selectedsemanticTypesList'>Selected</label>
          <span ng-repeat="type in selected.semanticTypes" ng-bind="type.description" ng-dblclick="unselect(type)" class="semantic-type noselect" id='selectedsemanticTypesList'></span>
        </div>
      </div>
        <div ng-grid="gridOptions" class="grid semantic-types-grid"></div>
      </div>
    </tab>
    
    <tab id="coding-systems-tab" heading="3. Coding systems" ng-controller="CodingSystemsCtrl">
      <div block-ui="inputBlockUi">
        <div class="row">
          <div class="col-md-2">
            <label for='vocabulariesFilter'>Filter {{all.count}} coding systems</label>
            <i class="glyphicon glyphicon-filter"></i>
            <input id='vocabulariesFilter' type="text" ng-model="gridOptions.filterOptions.filterText" />
            <div class='btn-group'> 
              <button class='btn btn-default btn-sm' ng-click="gridOptions.selectAll(true)">
                <i class="glyphicon glyphicon-expand"></i>
                Select all
              </button>
              <button class='btn btn-default btn-sm' ng-click="gridOptions.selectAll(false)">
                <i class="glyphicon glyphicon-unchecked"></i>
                none
              </button>
            </div>
          </div>
          <div class="col-md-10">
            <label for='selectedVocabulariesList'>Selected</label>
            <div id='selectedVocabulariesList'>
              <span ng-repeat="voc in selected.codingSystems" ng-bind="voc.abbreviation" ng-dblclick="unselect(voc.abbreviation)" class="vocabulary noselect"></span>
            </div>
          </div>
        </div>
        <div ng-grid="gridOptions" class="grid coding-systems-grid"></div>
      </div>
    </tab>
    
    <tab id="concepts-tab" heading="4. Concepts" ng-click="state != null || createInitalTranslations(caseDefinition)">

      <button title="Create the automatic coding of the case definition"
            ng-click="createInitalTranslations(caseDefinition)"
            ng-if="state == null"
            class="btn btn-primary btn-sm center-block"
            id="search-concepts">
        <i class="glyphicon glyphicon-refresh"></i>
        Create initial coding
      </button>
    
      <div ng-if="state" class="concepts-controls row">
       
       <div class="filters col-md-2">
         <label>Filter {{state.concepts.length}} concept<span ng-if="state.concepts.length != 1">s</span></label>
         <i class="glyphicon glyphicon-filter"></i>
         <input title="Filter concepts" placeholder="Query" type="text" ng-model="conceptsGridOptions.filterOptions.filterText" />
         <div class='btn-group'> 
           <button class='btn btn-default btn-sm' ng-click="conceptsGridOptions.selectAll(true)">
             <i class="glyphicon glyphicon-expand"></i>
             Select all
           </button>
           <button class='btn btn-default btn-sm' ng-click="conceptsGridOptions.selectAll(false)">
             <i class="glyphicon glyphicon-unchecked"></i>
             none
           </button>
         </div>
       </div>
        
        <div class="modify-concepts col-md-4">
          <label>
            Modify {{selectedConcepts.length}} concept<span ng-if="selectedConcepts.length != 1">s</span>
          </label>
          <button class='btn btn-default btn-sm' ng-click='operationDeleteConcepts(selectedConcepts)' confirm-click="Delete selected concepts?" ng-disabled="selectedConcepts.length == 0" title='Delete concepts'> 
            <i class='glyphicon glyphicon-remove-circle'></i>
            Delete 
          </button>
          
          <div class='btn-group'> 
              <button class='btn btn-default btn-sm' ng-click='operationExpandRelatedConcepts(selectedConcepts, false)' ng-disabled="selectedConcepts.length == 0" title='Expand to more general concepts'> 
                <i class='glyphicon glyphicon-chevron-up'></i>
                Expand to more general concepts 
              </button> 
              <button class='btn btn-default btn-sm' ng-click='operationExpandRelatedConcepts(selectedConcepts, true)' ng-disabled="selectedConcepts.length == 0" title='Expand to more specific concepts'> 
                <i class='glyphicon glyphicon-chevron-down'></i>
                more specific concepts 
              </button> 
          </div>
          
          <button class="btn btn-default btn-sm" ng-click="operationEditCodes(selectedConcepts)" ng-disabled="selectedConcepts.length == 0" title="Enable/disable source codes">
            <i class='glyphicon glyphicon-edit'></i>
            Codes
          </button>
        </div>
        
        <div class="add-concepts col-md-3">
          <label>Search and add concept</label>
          <input type="text" ng-model="searchQuery" 
            placeholder="Query" title="Search and add concepts"
            typeahead="c.preferredName for c in autocompleteConcepts($viewValue)"
            typeahead-on-select="searchAndAddConceptDirect($item)"
            typeahead-wait-ms=250
            typeahead-min-length=3
            typeahead-focus-first=false
            ></input>
          <button title="Search and add concepts" ng-click="searchAndAddConcepts(searchQuery)"
            ng-disabled="!searchQuery" class="btn btn-default btn-sm">
            <i class="glyphicon glyphicon-search"></i>Search and add
          </button>
        </div>
        
        <div class="on-case-definition col-md-3">
          <label>Case definition <em ng-bind="caseDefinitionName"></em></label>
          <div class="btn-group">
            <button title="Save the coding online" ng-click="saveTranslations()" ng-if="state" ng-disabled="numberUnsafedChanges == 0" class="btn btn-default btn-sm">
              <i class="glyphicon glyphicon-cloud-upload"></i>
              Save
            </button>
            <button title="Download as CSV for Excel (after save)"
                ng-disabled="numberUnsafedChanges > 0"
                ng-click="downloadConcepts()"
                ng-if="state" class="btn btn-default btn-sm">
              <i class="glyphicon glyphicon-download"></i>
              Download
            </button>
          </div>
          <button title="Reset the coding - all changes are lost" ng-click="resetConcepts()" confirm-click="Do you really want to reset the current coding? All manual changes are lost." ng-if="state" class="btn btn-default btn-sm" id="reset-concepts">
            <i class="glyphicon glyphicon-fire"></i>
            Reset
          </button>
        </div>
      </div>
       
       <div ng-grid="conceptsGridOptions" class="grid concepts-grid" ng-if="state"></div>
    </tab>
    
    <tab id="history-tab" heading="5. History" select="updateHistoryGridStyle()">
      <div ng-grid="historyGridOptions" class="grid history-grid"></div>
    </tab>
  </tabset>
</div>